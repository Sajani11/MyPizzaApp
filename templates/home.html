{% extends "layout.html" %} {% block title %}Home - Pizza Center{% endblock %}
{% block content %}

<h1 class="text-center text-danger mb-4 gsap-heading">
  üçï You Order We Deliver <br />
  <br />We offer spin rewards!!
</h1>

<div class="container mt-4">
  <div class="input-group mb-3">
    <input
      type="text"
      class="form-control"
      placeholder="Search pizzas..."
      id="searchInput"
      onkeyup="filterPizzas()"
    />
    <span class="input-group-text bg-white">
      <i class="fas fa-search text-muted"></i>
    </span>
  </div>
</div>

<!-- üçï Pizza Grid -->
<div class="container">
  <div class="row gx-4 gy-4" id="pizzaList">
    {% for pizza in pizzas %}
    <div
      class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4 pizza-item"
      data-name="{{ pizza[1] | lower }}"
    >
      <div class="card text-center pizza-card">
        <img
          src="{{ pizza[4] }}"
          class="rounded-circle img-fluid pizza-img mx-auto mt-3"
          alt="{{ pizza[1] }}"
        />
        <div class="card-body">
          <h5 class="card-title">{{ pizza[1] }}</h5>
          <p class="card-text">{{ pizza[2] }}</p>
          <p class="text-success">Rs. {{ pizza[3] }}</p>

          {% if session.get('role') == 'Admin' %}
          <div class="admin-controls mt-2">
            <button
              class="btn btn-warning w-100 mb-2"
              onclick="showEditPizzaModal('{{ pizza[0] }}', '{{ pizza[1] }}', '{{ pizza[3] }}', '{{ pizza[2] }}')"
            >
              Edit Pizza
            </button>
            <button
              class="btn btn-danger w-100"
              onclick="showDeletePizzaModal('{{ pizza[0] }}', '{{ pizza[1] }}')"
            >
              Delete Pizza
            </button>
          </div>
          {% elif session.get('user_id') %}
          <a
            href="#"
            class="btn btn-primary w-100"
            onclick="showOrderModal('{{ pizza[0] }}')"
          >
            Add to cart
          </a>
          {% else %}
          <a href="{{ url_for('choose_auth') }}" class="btn btn-warning w-100"
            >Add to cart</a
          >
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- No Match Message -->
<div
  id="noResultMsg"
  class="text-center text-danger fw-bold mt-4"
  style="display: none"
>
  üòî No pizzas matched your search.
</div>

<!-- üçï Customization Modal -->
<div
  class="modal fade"
  id="orderChoiceModal"
  tabindex="-1"
  aria-labelledby="orderChoiceLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="orderChoiceLabel">Customize Your Pizza?</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body text-center">
        <!-- POST form to add to cart -->
        <form id="addToCartForm" method="POST" action="">
          <button type="submit" class="btn btn-outline-success m-2 w-100">
            Add Regular Pizza to Cart
          </button>
        </form>

        <!-- Customize button still redirects to customize page -->
        <button id="customizeBtn" class="btn btn-outline-primary m-2 w-100">
          Customize Pizza
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Delete Pizza Modal -->
<div class="modal fade" id="deletePizzaModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title">Confirm Pizza Deletion</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body text-center">
        <p class="fw-bold text-danger">
          Are you sure you want to delete <span id="pizzaNameToDelete"></span>?
        </p>
        <form id="deletePizzaForm" method="POST" action="">
          <input type="hidden" name="pizza_id" id="pizzaIdToDelete" />
          <button type="submit" class="btn btn-danger w-100">
            Yes, Delete Pizza
          </button>
        </form>
        <button
          type="button"
          class="btn btn-secondary w-100 mt-2"
          data-bs-dismiss="modal"
        >
          Cancel
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Edit Pizza Modal -->
<div class="modal fade" id="editPizzaModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title">Edit Pizza</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <form id="editPizzaForm" method="POST" action="">
          <input type="hidden" name="pizza_id" id="editPizzaId" />
          <div class="mb-3">
            <label for="editPizzaName" class="form-label">Pizza Name</label>
            <input
              type="text"
              class="form-control"
              name="name"
              id="editPizzaName"
            />
          </div>
          <div class="mb-3">
            <label for="editPizzaPrice" class="form-label">Price</label>
            <input
              type="number"
              step="0.01"
              class="form-control"
              name="price"
              id="editPizzaPrice"
            />
          </div>
          <div class="mb-3">
            <label for="editPizzaDesc" class="form-label">Description</label>
            <textarea
              class="form-control"
              name="description"
              id="editPizzaDesc"
            ></textarea>
          </div>
          <button type="submit" class="btn btn-primary w-100">
            Save Changes
          </button>
        </form>
      </div>
    </div>
  </div>
</div>



{% endblock %}
