{% extends "layout.html" %} {% block title %}Home - Pizza Center{% endblock %}
{% block content %}

<h1 class="text-center text-danger mb-4 gsap-heading">
  üçï You Order We Deliver <br />
  <br />We offer spin rewards!!
</h1>

<div class="container mt-4">
  <div class="input-group mb-3">
    <input
      type="text"
      class="form-control"
      placeholder="Search pizzas..."
      id="searchInput"
      onkeyup="filterPizzas()"
    />
    <span class="input-group-text bg-white">
      <i class="fas fa-search text-muted"></i>
    </span>
  </div>
</div>

<!-- üçï Pizza Grid -->
<div class="container">
  <div class="row gx-4 gy-4" id="pizzaList">
    {% for pizza in pizzas %}
    <div
      class="col-12 col-sm-6 col-md-4 col-lg-3 mb-4 pizza-item"
      data-name="{{ pizza[1] | lower }}"
    >
      <div class="card text-center pizza-card">
        <img
          src="{{ pizza[4] }}"
          class="rounded-circle img-fluid pizza-img mx-auto mt-3"
          alt="{{ pizza[1] }}"
        />
        <div class="card-body">
          <h5 class="card-title">{{ pizza[1] }}</h5>
          <p class="card-text">{{ pizza[2] }}</p>
          <p class="text-success">Rs. {{ pizza[3] }}</p>

          {% if session.get('user_id') %}
          <a
            href="#"
            class="btn btn-primary w-100"
            onclick="showOrderModal('{{ pizza[0] }}')"
          >
            Add to cart
          </a>
          {% else %}
          <a href="{{ url_for('choose_auth') }}" class="btn btn-warning w-100">
            Add to cart
          </a>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

<!-- No Match Message -->
<div
  id="noResultMsg"
  class="text-center text-danger fw-bold mt-4"
  style="display: none"
>
  üòî No pizzas matched your search.
</div>

<!-- üçï Customization Modal -->
<div
  class="modal fade"
  id="orderChoiceModal"
  tabindex="-1"
  aria-labelledby="orderChoiceLabel"
  aria-hidden="true"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="orderChoiceLabel">Customize Your Pizza?</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body text-center">
        <p>Would you like to customize your pizza or order the regular one?</p>

        <!-- POST form to add to cart -->
        <form id="addToCartForm" method="POST" action="">
          <!-- Size selection -->
          <div class="mb-3 text-start">
            <label for="sizeSelect" class="form-label">Size</label>
            <select id="sizeSelect" class="form-select" name="size">
              <option value="small" selected>Small</option>
              <option value="medium">Medium (+Rs.100)</option>
              <option value="large">Large (+Rs.200)</option>
            </select>
          </div>

          <!-- Quantity selection -->
          <div class="mb-3 text-start">
            <label for="quantityInput" class="form-label">Quantity</label>
            <input
              type="number"
              id="quantityInput"
              name="quantity"
              class="form-control"
              min="1"
              value="1"
            />
          </div>

          <button type="submit" class="btn btn-outline-success m-2 w-100">
            Add Regular Pizza to Cart
          </button>
        </form>

        <!-- Customize button still redirects to customize page -->
        <button id="customizeBtn" class="btn btn-outline-primary m-2 w-100">
          Customize Pizza
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ‚ú® GSAP & Custom Script -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<script>
  // GSAP Animations
  gsap.from(".gsap-heading", { opacity: 0, y: -50, duration: 1 });
  gsap.from(".gsap-add", { opacity: 0, y: 50, duration: 1, delay: 0.3 });
  gsap.from(".pizza-item", {
    opacity: 0,
    scale: 0.8,
    duration: 0.6,
    stagger: 0.1,
    delay: 0.6,
  });

  // Function to filter pizzas based on the search input
  function filterPizzas() {
    const input = document.getElementById("searchInput").value.toLowerCase();
    const items = document.querySelectorAll(".pizza-item");
    let found = false;

    items.forEach((item) => {
      const name = item.getAttribute("data-name");
      if (name.includes(input)) {
        item.style.display = "block";
        gsap.fromTo(
          item,
          { opacity: 0, scale: 0.8 },
          { opacity: 1, scale: 1, duration: 0.4 }
        );
        found = true;
      } else {
        item.style.display = "none";
      }
    });

    document.getElementById("noResultMsg").style.display = found
      ? "none"
      : "block";
  }

  let selectedPizzaId = null;

  function showOrderModal(pizzaId) {
    selectedPizzaId = pizzaId;

    // Set the form action to the add-to-cart route with the current pizzaId
    const form = document.getElementById("addToCartForm");
    form.action = `/add-to-cart/${pizzaId}`;

    // Show the modal
    const modal = new bootstrap.Modal(
      document.getElementById("orderChoiceModal")
    );
    modal.show();
  }

  // Redirect customize button to customize page
  document.addEventListener("DOMContentLoaded", function () {
    document
      .getElementById("customizeBtn")
      .addEventListener("click", function () {
        window.location.href = `/customize/${selectedPizzaId}`;
      });
  });
</script>

{% endblock %}
